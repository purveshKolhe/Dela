<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dela - Secure P2P File Sharing</title>
    <meta name="description" content="Share files securely peer-to-peer with real-time chat. No servers, no storage, no tracking.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="icon" href="assets/images/logo.png" type="image/png">
</head>
<body class="light-theme">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <img src="assets/images/logo.png" alt="Dela Logo" class="logo-icon">
            </div>
            <h1 class="title">Dela</h1>
            <span class="subtitle">Secure P2P Sharing</span>
        </div>
        
        <button class="theme-toggle" id="themeToggle">
            <span class="theme-icon">☀️</span>
            <span class="theme-label">Light</span>
        </button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Left Panel -->
        <div class="left-panel">
            <!-- Error Message -->
            <div class="error-message hidden" id="errorMessage">
                <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="errorText"></span>
            </div>

            <!-- Connection Status -->
            <div class="connection-status">
                <div class="status-info">
                    <div class="status-indicator disconnected" id="statusIndicator"></div>
                    <span class="status-text" id="statusText">Not Connected</span>
                </div>
                
                <div class="connection-buttons" id="connectionButtons">
                    <button class="btn btn-primary" id="createConnectionBtn">Create Connection</button>
                    <button class="btn btn-secondary" id="joinConnectionBtn">Join Connection</button>
                </div>
            </div>

            <!-- File Drop Zone -->
            <div class="file-drop-zone" id="fileDropZone">
                <input type="file" class="file-input" id="fileInput" accept="*">
                
                <div class="drop-zone-content">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                    </div>
                    
                    <div class="drop-zone-text">
                        <h3 id="dropZoneTitle">Share a file</h3>
                        <p>Drag & drop or click to select a file (max 1GB)</p>
                    </div>
                    
                    <button type="button" class="btn btn-primary" id="selectFileBtn">Choose File</button>
                </div>
            </div>

            <!-- Selected File -->
            <div class="selected-file hidden" id="selectedFile">
                <div class="selected-file-header">
                    <h3>Selected File</h3>
                    <button class="remove-file-btn" id="removeFileBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <div class="file-info">
                    <div class="file-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    
                    <div class="file-details">
                        <p class="file-name" id="fileName"></p>
                        <p class="file-size" id="fileSize"></p>
                    </div>
                    
                    <button class="btn btn-success" id="sendFileBtn" disabled>Send File</button>
                </div>
            </div>

            <!-- File Transfer Progress -->
            <div class="file-transfer hidden" id="fileTransfer">
                <h3 id="transferTitle">Transferring file...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-text" id="progressText">0%</p>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <h3>How it works</h3>
                <div class="instruction-list">
                    <p>1. Select a file you want to share (up to 1GB)</p>
                    <p>2. Create a connection or join an existing one</p>
                    <p>3. Share the connection code with the recipient</p>
                    <p>4. Start sharing files and chatting securely!</p>
                </div>
            </div>
        </div>

        <!-- Right Panel - Chat -->
        <div class="right-panel">
            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <h3>Chat</h3>
                    <div class="chat-status">
                        <div class="chat-indicator disconnected" id="chatIndicator"></div>
                        <span class="chat-status-text" id="chatStatusText">Disconnected</span>
                    </div>
                </div>

                <!-- Messages -->
                <div class="messages-container" id="messagesContainer">
                    <div class="no-messages" id="noMessages">
                        <svg class="message-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                        </svg>
                        <p>No messages yet</p>
                        <p class="small">Start a conversation!</p>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="message-input-container">
                    <div class="message-input-wrapper">
                        <input 
                            type="text" 
                            class="message-input" 
                            id="messageInput"
                            placeholder="Connect to start chatting"
                            disabled
                        >
                        <button class="send-btn" id="sendBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Connection Modal -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Create Connection</h3>
                <button class="close-btn" id="closeModalBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="modal-content">
                <!-- Create Connection View -->
                <div class="create-connection-view" id="createConnectionView">
                    <p>Share this code with the person you want to connect with:</p>
                    
                    <!-- QR Code -->
                    <div class="qr-container">
                        <div class="qr-code" id="qrCode"></div>
                    </div>
                    
                    <!-- Connection Code -->
                    <div class="connection-code">
                        <textarea readonly id="connectionCode" class="code-textarea"></textarea>
                        <button class="btn btn-secondary" id="copyCodeBtn">Copy Code</button>
                    </div>
                    
                    <p class="waiting-text">Waiting for connection...</p>
                </div>
                
                <!-- Join Connection View -->
                <div class="join-connection-view hidden" id="joinConnectionView">
                    <p>Paste the connection code you received:</p>
                    
                    <textarea 
                        class="code-textarea" 
                        id="joinCodeInput" 
                        placeholder="Paste connection code here..."
                    ></textarea>
                    
                    <button class="btn btn-primary" id="connectBtn">Connect</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" onload="console.log('QRCode library loaded')" onerror="console.error('QRCode library failed to load')"></script>
    <script>
        // Ensure QRCode loads before other scripts
        window.addEventListener('load', function() {
            if (typeof QRCode === 'undefined') {
                console.error('QRCode library not available, loading fallback...');
                // Load fallback QR library
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js';
                script.onload = () => console.log('QRCode fallback loaded');
                document.head.appendChild(script);
            }
        });
    </script>
    <script src="assets/js/websocket_service.js"></script>
    <script src="assets/js/script.js"></script>
</body>
</html>